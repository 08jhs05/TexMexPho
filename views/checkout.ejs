<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Home Page</title>

    <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
    <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />
    <link rel="stylesheet" href="/styles/layout.css" type="text/css" />

    <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
    <!-- <script type="text/javascript" src="/scripts/app.js"></script> -->

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
    integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  </head>
  <body>
    <%- include('partials/_header'); %>
    <div class="header-filler"> </div>
    <div class="checkout-container">
      <h3 class="order-title">Your Order</h3>
      <div class="borderline"></div>
      <div class="order-columns">
        <div class="column">ITEMS</div>
        <div class="column">QUANTITY</div>
        <div class="column">PRICE</div>
        <div class="column">TOTAL</div>
      </div>
        <% for(const item in templatevars) { %>
          <div class="order-item-rows">
            <div class="item-name"> <img src="<%= templatevars[item].photo_url %> asdasd.jpg" class="item-photo"> <%= item %> </div>
            <div class="item-quantity"> <%= templatevars[item].quantity %> </div>
            <div class="item-price"> <%= (templatevars[item].price/100).toFixed(2) %> </div>
            <div class="item-total"> <%= ((templatevars[item].price * templatevars[item].quantity)/100).toFixed(2) %> </div>
          </div>
        <% } %>
        <div class="tax-total-row">
          <div class="subtotal"></div>
          <div class="tax"></div>
          <div class="borderline"></div>
          <div class="total"></div>
        </div>
        <form>
          <label for="text" class="inline-label">Phone number: </label>
          <input type="text" id="phone" name="fname"><br>
        </form>
        <button type="submit" class="btn btn-primary btn-lg btn-block" id="checkout-button">CHECKOUT</button>
    </div>
    <script>

      const insertOrder_item = JSON.parse('<%- JSON.stringify(templatevars) %>');
      let subtotal = 0;

      console.log(insertOrder_item);

      $(".order-item-rows").each(function() {
          subtotal += (Number($(this).find(".item-total")[0].textContent));
        }
      )

      let tax = ( subtotal * 0.13 ).toFixed(2);
      let total = Number(subtotal) + Number(tax);

      $(".subtotal").html(`Subtotal: ${subtotal}`);
      $(".tax").html(`Tax: ${tax}`);
      $(".total").html(`TOTAL: ${Number(subtotal) + Number(tax)}`);

      $("#checkout-button").click(function() {
        let phone = document.getElementById("phone").value;

        const insertOrder = {time_placed:  '2021-05-03 18:03:02', subtotal: subtotal * 100, tax: tax * 100, final_price: total * 100, phone: phone};

        $.post("/orderplaced", { insertOrder, insertOrder_item })
        .done(function(res){
          window.location = "/orderplaced"; });
      })
    </script>
  </body>
</html>
<!-- confirmOrder - was in p tag -->
